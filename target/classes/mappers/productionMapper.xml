<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.eatit.mapper.productionMapper">
  
  <resultMap type="com.eatit.productionDomain.productionVO" id="productionVO">
  <result property="production_no" column="production_no"/>
  <result property="machine_code" column="machine_code"/>
  <result property="product_no" column="product_no"/>
  <result property="employee_no" column="employee_no"/>
  <result property="recipe_no" column="recipe_no"/>
  <result property="production_time" column="production_time"/>
  <!-- <collection property="" resultMap=""></collection> -->
  </resultMap>

  <!-- 설비 페이징 처리 갯수 -->
  <select id="machinetotalCount" resultType="int">
  		<![CDATA[
	  		SELECT COUNT(*)
	  		FROM machine
	  		WHERE machine_code > 0
  		]]>
  </select>


  <insert id="productionhistory">
  INSERT INTO production_history(product_no, production_quantity, defective_product, products, date_of_manufacture, EXPiry_date, machine_code)
  VALUES (#{product_no}, #{production_quantity}, #{defective_product}, #{products}, NOW(), ADDDATE(DATE(NOW()), INTERVAL #{EXP_intervar} DAY), #{machine_code});
  </insert>
  
  <!--  전체 내역 조회  -->
 <select id="selectOrderlist" resultType="ordersVO">
 SELECT o.*, mi.name "product_name", c.company_name, c.company_tel, s.quantity "stock_quantity"
 FROM orders o JOIN company c
 ON o.company_no = c.company_no
 JOIN masterdata_information mi
 ON o.product_no = mi.product_no
 LEFT JOIN (SELECT product_code, SUM(quantity) AS quantity FROM stock GROUP BY product_code) s
 ON mi.code = s.product_code WHERE o.delete_status = 0
 ORDER BY o.order_date DESC
 LIMIT #{startPage}, #{pageSize}
 </select>
  
  
  
  
  </mapper>
  
  