<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eatit.mapper.masterDataMapper">

	<resultMap type="com.eatit.masterdataDomain.MasterdataVO" id="product">
		<result property="product_no" column="product_no" />
		<result property="product_code" column="product_code" />
		<result property="product_name" column="product_name" />
		<result property="product_category" column="product_category" />
		<result property="product_category_detail"
			column="product_category_detail" />
		<result property="company_no" column="company_no" />
		<result property="product_unit" column="product_unit" />
		<result property="product_price" column="product_price" />
		<result property="expiry_date" column="expiry_date" />


	</resultMap>
	
	
	<select id="countProduct" resultType="int">
  	  <![CDATA[
	  	  select count(*) from product_information 
	  	  where product_category = '완제품'
   	  ]]>
	</select>
	
	
	<select id="mtotalCount" resultType="int">
  		<![CDATA[
	  		SELECT COUNT(*)
	  		FROM product_information
	  		where product_category = '원자재'
	  		
  		]]>
  	</select>
  	
  		
	<select id="ftotalCount" resultType="int">
  		<![CDATA[
	  		SELECT COUNT(*)
	  		FROM machine	  			  		
  		]]>
  	</select>
  	
  			
	<select id="qtotalCount" resultType="int">
  		<![CDATA[
	  		SELECT COUNT(*)
	  		FROM quality	  			  		
  		]]>
  	</select>
  	
  	
  	

	<select id="getProductList" resultType="MasterdataVO">
		SELECT pi.*, r.*
		FROM product_information pi
		LEFT JOIN recipe r ON pi.product_code = r.product_code
		WHERE pi.product_category = '완제품'
	</select>


	<select id="getMIMList" resultType="MasterdataVO">
		select * from product_information
		where product_category='원자재'
		order by product_no desc
		limit
		#{startPage},#{pageSize}
	</select>
	
	
	<select id="getFIMList" resultType="machineVO">
		 select * from machine
		
		order by machine_code desc
		limit
		#{startPage},#{pageSize}
	</select>
	
	<select id="getCategoryList" resultType="MasterdataVO">
		 select * from product_information
		 where product_category = '완제품'
		
		order by product_no desc
		
	</select>
	
	
	
	<select id="getQIMList" resultType="MasterdataVO">
		SELECT q.*, pi.*
		FROM quality q
		LEFT JOIN product_information pi ON pi.product_code = q.product_code
		
		order by quality_no desc
		limit
		#{startPage},#{pageSize}
	</select>
	
	

	<insert id="insertProduct">
		insert into
		product_information(product_code,product_name,product_category_detail,company_no,product_unit,product_price,product_category)
		values(#{product_code},#{product_name},#{product_category_detail},#{company_no},#{product_unit},#{product_price},'완제품')
	</insert>

	<insert id="insertRecipe" parameterType="MasterdataVO">
		<!-- recipe 테이블에 데이터 삽입 -->
		INSERT INTO recipe (product_code,recipe)
		VALUES
		(#{product_code},#{recipe});
	</insert>
	
	
	<insert id="insertQIM">
		insert into
		quality(product_code,product_visual,taste,scent,texture,measure)
		values(#{product_code},#{product_visual},#{taste},#{scent},#{texture},#{measure})
	</insert>

	<insert id="insertMIM">
		insert into
		product_information(product_code,product_name,product_category_detail,company_no,product_unit,product_price,product_category)
		values(#{product_code},#{product_name},#{product_category_detail},#{company_no},#{product_unit},#{product_price},'원자재')
	</insert>
	
	<insert id="insertFIM">
	  insert into 
	  machine(machine_name,machine_status,employee_no,purpose_of_use,installation_date,machine_location)
	  values(#{machine_name},#{machine_status},#{employee_no},#{purpose_of_use},#{installation_date},#{machine_location})
	</insert>


	<update id="updateProduct">
		update product_information
		set product_code =
		#{product_code},
		product_name = #{product_name},
		product_category =
		COALESCE(#{product_category}, product_category, '완제품'),
		product_category_detail = #{product_category_detail},
		company_no =
		#{company_no},
		product_unit = #{product_unit},
		product_price =
		#{product_price}
		
		where product_no =
		#{product_no};
	</update>
	<update id="updateMIM">
		update product_information
		set product_code =
		#{product_code},
		product_name = #{product_name},
		product_category =
		COALESCE(#{product_category}, product_category, '원자재'),
		product_category_detail = #{product_category_detail},
		company_no =
		#{company_no},
		product_unit = #{product_unit},
		product_price =
		#{product_price}		
		where product_no =
		#{product_no};
	</update>
	
	<update id="updateFIM">
		update machine
		set machine_name =
		#{machine_name},
		machine_status = #{machine_status},		
		employee_no = #{employee_no},
		purpose_of_use =
		#{purpose_of_use},
		installation_date = #{installation_date},
		machine_location =
		#{machine_location}
		
		where machine_code =
		#{machine_code};
	</update>
	
	



	<update id="updateRecipe">
		UPDATE recipe
		SET recipe = #{recipe}
		WHERE product_code
		= #{product_code};
	</update>


	<delete id="deleteRecipeByProductCode">
		delete from recipe
		where product_code =
		#{product_code}
	</delete>

	<delete id="deleteProduct">
		delete from product_information
		where product_no =
		#{product_no}
	</delete>
	
	<delete id="deleteAllRecipeByProductCode">
		delete from recipe
		where product_code =
		#{product_code}
	</delete>
	
	<delete id="deleteRPC">
    delete from recipe
    where product_code = #{product_code}
</delete>

<delete id="deleteQuality">
    delete from quality
    where quality_no = #{quality_no}
</delete>

<delete id="deletePC">
    delete from product_information
    where product_code = #{product_code}
</delete>
	

	<delete id="deleteAllProduct">
		delete from product_information
		where product_no =
		#{product_no}
	</delete>
	
	
	
	<delete id="deleteMIM">
		delete from product_information
		where product_no =
		#{product_no}
	</delete>
	
	
	<delete id="deleteFIM">
		delete from machine
		where machine_code =
		#{machine_code}
	</delete>
	



	<select id="MdListPage" resultType="MasterdataVO"
		resultMap="product">
		SELECT pi.*, r.*
		FROM product_information pi
		LEFT JOIN recipe r ON
		pi.product_code = r.product_code
		where product_category = '완제품'
		order by product_no desc
		limit
		#{startPage},#{pageSize}
	</select>

	
	
	<select id="getPIMSearchCount" resultType="int" parameterType="String">
  	  <![CDATA[
	  	  select count(*) FROM product_information pi
		LEFT JOIN recipe r ON pi.product_code = r.product_code
		WHERE
		pi.product_category = '완제품' AND (
        pi.product_name LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_code LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_category_detail LIKE CONCAT('%', #{keyword}, '%')
        OR pi.company_no LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_unit LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_price LIKE CONCAT('%', #{keyword}, '%')
        
        OR r.recipe LIKE CONCAT('%', #{keyword}, '%')
		)
   	  ]]>
	</select>
	
	<select id="getQIMSearchCount" resultType="int" parameterType="String">
  	  <![CDATA[
	  	  select count(*) FROM quality q
		LEFT JOIN product_information pi ON pi.product_code = q.product_code
		WHERE
		
        q.quality_no LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_code LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_name LIKE CONCAT('%', #{keyword}, '%')
        OR q.product_visual LIKE CONCAT('%', #{keyword}, '%')
        OR q.taste LIKE CONCAT('%', #{keyword}, '%')
        OR q.scent LIKE CONCAT('%', #{keyword}, '%')
        OR q.texture LIKE CONCAT('%', #{keyword}, '%')
        OR q.measure LIKE CONCAT('%', #{keyword}, '%')
   	  ]]>
	</select>
	
	
	<select id="getMIMSearchCount" parameterType="String"
		resultType="int">
		<![CDATA[
		select count(*)
		FROM product_information 		
		WHERE
		product_category = '원자재' AND (
        product_name LIKE CONCAT('%', #{keyword}, '%')
        OR product_code LIKE CONCAT('%', #{keyword}, '%')
        OR product_category_detail LIKE CONCAT('%', #{keyword}, '%')
        OR company_no LIKE CONCAT('%', #{keyword}, '%')
        OR product_unit LIKE CONCAT('%', #{keyword}, '%')
        OR product_price LIKE CONCAT('%', #{keyword}, '%')
              
		)
		  ]]>
	</select>
	
	<select id="getFIMSearchCount" parameterType="String" resultType="int">
  <![CDATA[
    SELECT COUNT(*) AS count
    FROM machine
    WHERE
      machine_code LIKE CONCAT('%', #{keyword}, '%')
      OR machine_name LIKE CONCAT('%', #{keyword}, '%')
      OR machine_status LIKE CONCAT('%', #{keyword}, '%')
      OR employee_no LIKE CONCAT('%', #{keyword}, '%')
      OR purpose_of_use LIKE CONCAT('%', #{keyword}, '%')
      OR installation_date LIKE CONCAT('%', #{keyword}, '%')
      OR machine_location LIKE CONCAT('%', #{keyword}, '%')
  ]]>
</select>
	
	
	
	

	<select id="searchProducts" parameterType="String"
		resultType="MasterdataVO">
		SELECT pi.*, r.*
		FROM product_information pi
		LEFT JOIN recipe r ON pi.product_code = r.product_code
		WHERE
		pi.product_category = '완제품' AND (
        pi.product_name LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_code LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_category_detail LIKE CONCAT('%', #{keyword}, '%')
        OR pi.company_no LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_unit LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_price LIKE CONCAT('%', #{keyword}, '%')
        
        OR r.recipe LIKE CONCAT('%', #{keyword}, '%')
		)
	</select>
	
	<select id="searchMIM" parameterType="String"
		resultType="MasterdataVO">
		SELECT *
		FROM product_information 		
		WHERE
		product_category = '원자재' AND (
        product_name LIKE CONCAT('%', #{keyword}, '%')
        OR product_code LIKE CONCAT('%', #{keyword}, '%')
        OR product_category_detail LIKE CONCAT('%', #{keyword}, '%')
        OR company_no LIKE CONCAT('%', #{keyword}, '%')
        OR product_unit LIKE CONCAT('%', #{keyword}, '%')
        OR product_price LIKE CONCAT('%', #{keyword}, '%')
               
		)
	</select>
	
	<select id="searchFIM" parameterType="String"
		resultType="machineVO">
		SELECT *
		FROM machine		
		WHERE		
        machine_code LIKE CONCAT('%', #{keyword}, '%')
        OR machine_name LIKE CONCAT('%', #{keyword}, '%')
        OR machine_status LIKE CONCAT('%', #{keyword}, '%')
        OR employee_no LIKE CONCAT('%', #{keyword}, '%')
        OR purpose_of_use LIKE CONCAT('%', #{keyword}, '%')
        OR installation_date LIKE CONCAT('%', #{keyword}, '%')
        OR machine_location LIKE CONCAT('%', #{keyword}, '%')        
		
	</select>
	
	
	<select id="searchQIM" parameterType="String"
		resultType="MasterdataVO">
		SELECT pi.*, q.*
		FROM quality q
		LEFT JOIN product_information pi ON pi.product_code = q.product_code
		WHERE
		
        q.quality_no LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_code LIKE CONCAT('%', #{keyword}, '%')
        OR pi.product_name LIKE CONCAT('%', #{keyword}, '%')
        OR q.product_visual LIKE CONCAT('%', #{keyword}, '%')
        OR q.taste LIKE CONCAT('%', #{keyword}, '%')
        OR q.scent LIKE CONCAT('%', #{keyword}, '%')
        OR q.texture LIKE CONCAT('%', #{keyword}, '%')
        OR q.measure LIKE CONCAT('%', #{keyword}, '%')
		
	</select>
	
	
	
	
	
	
	<select id="getCIMList" resultType="MasterdataVO">
		SELECT pi.*, r.*
		FROM product_information pi
		LEFT JOIN recipe r ON pi.product_code = r.product_code
		WHERE pi.product_category = '완제품'
	</select>
	
	
	
	



</mapper>